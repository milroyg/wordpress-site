/* 
*      Robo Gallery     
*      Version: 5.0.2 - 91160
*      By Robosoft
*
*      Contact: https://robogallery.co/ 
*      Created: 2025
*      Licensed under the GPLv3 license - http://www.gnu.org/licenses/gpl-3.0.html
 */
(()=>{let o={get(e){return window.fetch(e,{method:"GET",headers:{Accept:"application/json","X-WP-Nonce":roboGalleryFieldGallery.images_nonce}}).then(this._handleError).then(this._handleContentType).catch(this._throwError)},post(e,t){return window.fetch(e,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(this._handleError).then(this._handleContentType).catch(this._throwError)},_handleError(e){return e.ok?e:Promise.reject(e.statusText)},_handleContentType(e){var t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():Promise.reject("Oops, we haven't got JSON!")},_throwError(e){throw new Error(e)}};var a,i,s,c,d="gallery-library",r=document.getElementById("robo_gallery_images_preview"),t=document.getElementsByClassName("roboGalleryFieldImagesButton"),p=[];function n(e){jQuery(r);var t=roboGalleryFieldGallery.endpoint+"/images/";o.get(t+e).then(e=>{r.textContent="",e.forEach(e=>{var t=document.createElement("img");t.setAttribute("src",e.url),t.setAttribute("data-id",e.id),r.appendChild(t)})})}0==t.length?console.log("button not found "):(t=t[0],s=document.getElementById(t.getAttribute("data-id")),i=s.value,c=""==i?[]:i.split(","),n(i),void 0!==roboGalleryFieldGallery.preview_click&&roboGalleryFieldGallery.preview_click&&r.addEventListener("click",function(e){e.preventDefault(),e.target.matches("img")&&t.click()}),t.addEventListener("click",function(e){var l;i=s.value,c=""==i?[]:i.split(","),a||(0<c.length&&(d="gallery-edit"),(a=new wp.media.view.emWpGallery({multiple:!0,state:d,library:{order:"ASC",orderby:"title",type:"image",search:null,uploadedTo:null,multiple:!0}})).on("ready",function(){}),l=0,a.on("open",function(){i=s.value,c=""==i?[]:i.split(",");var t,e=a.state().get("library"),o=performance.now(),r=(e.reset(),performance.now());console.log(`Call to reset took ${r-o} milliseconds`);let n=function(e){p.hasMore()&&p.more().then(()=>{console.log("col",l++),n(p)})};0!=c.length&&(t=[],p=wp.media.query({post__in:c,posts_per_page:50}),n(p),o=performance.now(),c.forEach(function(e){t.push(wp.media.attachment(e))}),r=performance.now(),console.log(`Call to push took ${r-o} milliseconds`),o=performance.now(),e.add(t),r=performance.now(),console.log(`Call to library.add took ${r-o} milliseconds`),"gallery-edit"!=d)&&(a.setState("gallery-edit"),a.options.state="gallery-edit",d="gallery-edit")}),a.on("insert",function(){a.state().get("selection")}),a.on("update",function(e){var t=a.state(),e=e||t.get("selection");if(e){var o=e.toJSON();if(0!=o.length){c=[];for(var r=0;r<o.length;r++)c.push(o[r].id);n(i=c.join(",")),s.value=i}}else console.log("return selection")})),a.open()}),Sortable.create(r,{group:"robo_gallery_images_preview",animation:100,store:{get:function(e){var t=s.value;return""==t?[]:t.split(",")},set:function(e){e=e.toArray();s.value=e.join(",")}}}))})(jQuery);