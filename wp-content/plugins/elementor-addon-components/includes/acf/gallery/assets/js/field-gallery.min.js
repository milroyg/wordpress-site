class EacAcfFieldGallery{constructor(){this.datasets=[],"undefined"!=typeof acf&&void 0!==acf.addAction&&(this.addActions(),this.bindEvents(),this.setSortable())}setSortable(){jQuery(".eac-gallery__attachments").sortable({placeholder:"ui-state-highlight",tolerance:"pointer",cursor:"move",scrollSensitivity:30}).disableSelection()}addActions(){acf.addAction("ready_field/type=eac_gallery",this.initDatasets.bind(this)),acf.addAction("append_field/type=eac_gallery",this.initDatasets.bind(this))}bindEvents(){jQuery(document).on("click",".eac-gallery__add-media",this.onClickAddMedia.bind(this)),jQuery(document).on("click",".eac-gallery__remove-media",this.onClickRemoveMedia),jQuery(document).on("click",".eac-gallery__remove-all-media",this.onClickRemoveAllMedia)}wpMediaLibrary(e,t){const a=this;if(void 0!==wp.media){const i=wp.media({title:"Add Images",button:{text:"Add Images"},multiple:"add",library:{orderby:"date",order:"DESC",query:!0,type:eacGalleryImage.mimesType}});i.on("select",(function(){const n=i.state().get("selection").toJSON();if(!n)return;n.map((e=>e.id));let c=i.state().get("selection").map((e=>(e.toJSON(),e.attributes)));a.renderAttachments(c,e,t)})),i.on("open",(function(){let t=i.state().get("selection"),a=[];jQuery(e).children().each((function(){let e=jQuery(this).data("id");a.push(Number(e))})),a.length>0&&a.forEach((function(e){let a=wp.media.attachment(e);a.fetch(),t.add(a?[a]:[])}))})),i.open()}}renderAttachments(e,t,a){let i="";e.forEach((function(e){let t=e.icon,n="eac-gallery__attachment-picto";e.sizes&&e.sizes.medium?(t=e.sizes.medium.url,n="eac-gallery__attachment-container"):e.sizes&&e.sizes.full&&(t=e.sizes.full.url,n="eac-gallery__attachment-container"),i+=`<div data-id="${e.id}" class="${n}">`,i+=`<img src="${t}"/>`,i+=`<input id="${a.type}[${a.name}][]" type="hidden" value="${e.id}" name="${a.type}[${a.name}][]"/>`,i+="</div>"})),jQuery(t).html(i)}onClickAddMedia(e){e.preventDefault();const t=jQuery(e.currentTarget).closest(".eac-gallery__container").find(".eac-gallery__attachments"),a=t.attr("class").match(/eac-gallery__attachments-(\w+)/)[1],i=this.datasets.find((e=>e.key===a));this.wpMediaLibrary(t,i)}onClickRemoveMedia(e){e.preventDefault();const t=jQuery(e.currentTarget).closest(".eac-gallery__attachment-container").data("id");t&&confirm("Are you sure you want to remove this image ?")&&jQuery(`.eac-gallery__attachment-container-${t}`).remove()}onClickRemoveAllMedia(e){e.preventDefault();const t=jQuery(".eac-gallery__attachments");t&&t.children().length>0&&confirm("Are you sure you want to remove all images ?")&&jQuery(".eac-gallery__attachments").empty()}initDatasets(e){const t=e&&e.data;if(!t)return!1;this.datasets.push(t)}}new EacAcfFieldGallery;