import{EacReadTheFeed}from"../modules/eac-modules.js";class widgetNewsTicker extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{targetInstance:".eac-news-ticker",targetWrapper:".news-ticker_wrapper",targetWrapperTitle:".news-ticker_wrapper-title",targetWrapperContent:".news-ticker_wrapper-content div",targetWrapperControl:".news-ticker_wrapper-control",targetWrapperControlPlay:".play",targetWrapperControlPause:".pause",targetWrapperControlLeft:".left",targetWrapperControlRight:".right",targetItems:".news-ticker_item",targetNonce:"#news_nonce"}}}getDefaultElements(){const e=this.getSettings("selectors");return{$targetInstance:this.$element.find(e.targetInstance),$targetWrapper:this.$element.find(e.targetWrapper),$targetWrapperTitle:this.$element.find(e.targetWrapperTitle),$targetWrapperContent:this.$element.find(e.targetWrapperContent),$targetWrapperControl:this.$element.find(e.targetWrapperControl),$targetWrapperControlPlay:this.$element.find(e.targetWrapperControlPlay),$targetWrapperControlPause:this.$element.find(e.targetWrapperControlPause),$targetWrapperControlLeft:this.$element.find(e.targetWrapperControlLeft),$targetWrapperControlRight:this.$element.find(e.targetWrapperControlRight),$targetItems:this.$element.find(e.targetItems),nonce:this.$element.find(e.targetNonce).val(),settings:this.$element.find(e.targetWrapper).data("settings")||{},itemsArray:[],currentFeedIndex:0,iterationScrollCount:0,isRTL:!(!jQuery("html").attr("dir")||"rtl"!==jQuery("html").attr("dir"))}}onInit(){const e=this;super.onInit(),0!==Object.keys(this.elements.settings).length&&(this.elements.settings.data_auto&&(this.elements.$targetWrapperContent.removeClass("animationPause").addClass("animationPlay"),this.elements.$targetWrapperControlPlay.toggle(1),this.elements.$targetWrapperControlPause.toggle(1)),jQuery.each(this.elements.$targetItems,((t,n)=>{e.elements.itemsArray.push(n.innerHTML)})),this.setNewsTickerElements(this.elements.itemsArray[this.elements.currentFeedIndex],this.elements.settings,this.elements.nonce,this.elements.$targetWrapperTitle,this.elements.$targetWrapperContent))}bindEvents(){const e=this;this.elements.$targetWrapperControlPlay.on("keydown click",this.onControlEventPlay.bind(this)),this.elements.$targetWrapperControlPause.on("keydown click",this.onControlEventPause.bind(this)),this.elements.$targetWrapperControlPlay.on("animationend",(()=>{e.elements.$targetWrapperControlPlay.css("animation-play-state","paused")})),this.elements.$targetWrapperControlLeft.on("keydown click",this.onControlEventLeft.bind(this)),this.elements.$targetWrapperControlRight.on("keydown click",this.onControlEventRight.bind(this)),this.elements.$targetWrapperContent.on("animationiteration",this.onAnimationIteration.bind(this))}onControlEventPlay(e){const t=e.code||e.key||0;"keydown"===e.type&&"Enter"!==t&&"Space"!==t||(e.preventDefault(),this.elements.$targetWrapperContent.removeClass("animationPause").addClass("animationPlay"),this.elements.$targetWrapperControlPlay.css({display:"none","animation-play-state":"paused"}),this.elements.$targetWrapperControlPause.css("display","inline-block"),this.elements.$targetWrapperControlPause.focus(),this.elements.isRTL?this.elements.$targetWrapperContent.css({"-webkit-animation":"newsTickerHrzRtl "+this.elements.settings.data_speed+"s linear infinite",animation:"newsTickerHrzRtl "+this.elements.settings.data_speed+"s linear infinite"}):this.elements.$targetWrapperContent.css({"-webkit-animation":"newsTickerHrz "+this.elements.settings.data_speed+"s linear infinite",animation:"newsTickerHrz "+this.elements.settings.data_speed+"s linear infinite"}))}onControlEventPause(e){const t=e.code||e.key||0;"keydown"===e.type&&"Enter"!==t&&"Space"!==t||(e.preventDefault(),this.elements.$targetWrapperContent.removeClass("animationPlay").addClass("animationPause"),this.elements.$targetWrapperControlPlay.css({display:"inline-block","animation-play-state":"running"}),this.elements.$targetWrapperControlPlay.focus(),this.elements.$targetWrapperControlPause.css("display","none"))}onControlEventLeft(e){const t=e.code||e.key||0;"keydown"===e.type&&"Enter"!==t&&"Space"!==t||(e.preventDefault(),this.elements.$targetWrapperContent.removeClass("animationPlay"),this.elements.$targetWrapperControlPlay.css({display:"none",display:"inline-block","animation-play-state":"running"}),this.elements.$targetWrapperControlPause.css("display","none"),this.elements.$targetWrapperContent.css({"-webkit-animation":"restartNewsTickerHrz",animation:"restartNewsTickerHrz"}),this.elements.currentFeedIndex=this.elements.currentFeedIndex-1<=0?0:this.elements.currentFeedIndex-1,this.elements.iterationScrollCount=0,this.elements.$targetWrapperTitle.html(""),this.elements.$targetWrapperContent.empty(),this.setNewsTickerElements(this.elements.itemsArray[this.elements.currentFeedIndex],this.elements.settings,this.elements.nonce,this.elements.$targetWrapperTitle,this.elements.$targetWrapperContent))}onControlEventRight(e){const t=e.code||e.key||0;"keydown"===e.type&&"Enter"!==t&&"Space"!==t||(e.preventDefault(),this.elements.$targetWrapperContent.removeClass("animationPlay"),this.elements.$targetWrapperControlPlay.css({display:"inline-block","animation-play-state":"running"}),this.elements.$targetWrapperControlPause.css("display","none"),this.elements.$targetWrapperContent.css({"-webkit-animation":"restartNewsTickerHrz",animation:"restartNewsTickerHrz"}),this.elements.currentFeedIndex=this.elements.currentFeedIndex+1>=this.elements.itemsArray.length?0:this.elements.currentFeedIndex+1,this.elements.iterationScrollCount=0,this.elements.$targetWrapperTitle.html(""),this.elements.$targetWrapperContent.empty(),this.setNewsTickerElements(this.elements.itemsArray[this.elements.currentFeedIndex],this.elements.settings,this.elements.nonce,this.elements.$targetWrapperTitle,this.elements.$targetWrapperContent))}onAnimationIteration(){this.elements.iterationScrollCount++,this.elements.iterationScrollCount>this.elements.settings.data_loop-1&&(this.elements.iterationScrollCount=0,this.elements.currentFeedIndex++,this.elements.currentFeedIndex>=this.elements.itemsArray.length&&(this.elements.currentFeedIndex=0),this.elements.$targetWrapperTitle.html(""),this.elements.$targetWrapperContent.empty(),this.setNewsTickerElements(this.elements.itemsArray[this.elements.currentFeedIndex],this.elements.settings,this.elements.nonce,this.elements.$targetWrapperTitle,this.elements.$targetWrapperContent))}setNewsTickerElements(e,t,n,s,r){const a=e.split("::")[0],i=e.split("::")[1],l=new EacReadTheFeed(i.replace(/\s+/g,""),n,t.data_id);jQuery(document).on("ajaxComplete",((e,n,i)=>{if(null!==l&&i.ajaxOptions&&i.ajaxOptions===l.getOptions()){e.stopImmediatePropagation();const n=l.getItems();if(n.headError)return s.text(a),r.append('<p class="news-ticker_content-item"><span>'+n.headError+"</span></p>"),r.css("animation-duration","10s !important"),!1;if(!n.rss)return s.text(a),r.append('<p class="news-ticker_content-item"><span>Nothing to display</span></p>'),r.css("animation-duration","10s !important"),!1;n.profile.headTitle;const i=n.profile.headLink,o=n.rss;r.css("animation-duration",t.data_speed+"s"),s.html("<a href='"+i+"'>"+a+"</a>"),jQuery.each(o,((e,n)=>{if(e>=t.data_nombre)return!1;const s=n.title,a=n.lien,i=t.data_date?new Date(n.update).toLocaleDateString():"",l="left"===t.data_rtl?"<p class='news-ticker_content-item'><span class='date'>"+i+"</span><a href='"+a+"' tabindex='-1'><span class='news'>"+s+"</span></a><span class='separator'>|</span></p>":"<p class='news-ticker_content-item'><a href='"+a+"' tabindex='-1'><span class='news'>"+s+"</span></a><span class='date'>"+i+"</span><span class='separator'>|</i></span></p>";"left"===t.data_rtl?r.append(l):r.prepend(l)}))}}))}}jQuery(window).on("elementor/frontend/init",(()=>{elementorFrontend.elementsHandler.attachHandler("eac-addon-news-ticker",widgetNewsTicker)}));