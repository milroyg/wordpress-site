import{EacSwiper,setGridItemsGlobalLink}from"../modules/eac-modules.js";class widgetAdvancedGallery extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{targetInstance:".eac-advanced-gallery",target:".advanced-gallery",targetSkipGrid:".eac-skip-grid",targetCards:".advanced-gallery__inner-wrapper",imagesInstance:".advanced-gallery__image-instance",itemsInstance:".advanced-gallery__item",targetJustify:".fj-gallery",filterWrapperLink:".ag-filters__wrapper a",filterWrapperSelect:".ag-filters__select"}}}getDefaultElements(){const e=this.getSettings("selectors");let t={$targetInstance:this.$element.find(e.targetInstance),$target:this.$element.find(e.target),$targetSkipGrid:this.$element.find(e.targetSkipGrid),$targetCards:this.$element.find(e.targetCards),$imagesInstance:this.$element.find(e.imagesInstance),$itemsInstance:this.$element.find(e.itemsInstance),$targetJustify:this.$element.find(e.targetJustify),filterWrapper:".ag-filters__wrapper",$filterWrapperLink:this.$element.find(e.filterWrapperLink),filterItem:".ag-filters__item",filterActive:"ag-active",$filterWrapperSelect:this.$element.find(e.filterWrapperSelect),settings:this.$element.find(e.target).data("settings")||{},$targetId:null,widgetId:this.$element.data("id"),iso:null,isotopeOptions:{itemSelector:".advanced-gallery__item",percentPosition:!0,masonry:{columnWidth:".advanced-gallery__item-sizer"},fitRows:{equalheight:!1},layoutMode:"fitRows",sortBy:"original-order",visibleStyle:{transform:"scale(1)",opacity:1}},justifyOptions:{itemSelector:".fj-gallery-item",rowHeight:250,rowHeightTolerance:0,edgeCaseMinRowHeight:1,gutter:10,calculateItemsHeight:!0},has_swiper:!1};return t.$targetId=jQuery(t.settings.data_id),t.isotopeOptions.layoutMode=t.settings.data_layout,t.isotopeOptions.fitRows.equalheight="fitRows"===t.settings.data_layout,t.justifyOptions.gutter=t.settings.data_gutter,t.justifyOptions.rowHeight=t.settings.data_rowheight,t.has_swiper=t.settings.data_sw_swiper||!1,t}onInit(){super.onInit(),this.elements.has_swiper?new EacSwiper(this.elements.settings,this.elements.$targetInstance):"justify"!==this.elements.settings.data_layout&&(this.elements.settings.data_metro?this.elements.$itemsInstance.eq(0).addClass("mode-metro"):this.elements.$itemsInstance.eq(0).removeClass("mode-metro")),elementorFrontend.isEditMode()||setGridItemsGlobalLink(this.elements.$targetCards)}bindEvents(){elementorFrontend.isEditMode()||(!this.elements.has_swiper&&this.elements.settings.data_filtre&&(this.elements.$filterWrapperLink.on("click",(e=>{this.onFilterGridClick(e)})),this.elements.$filterWrapperSelect.on("change",(e=>{this.onFilterGridChange(e)}))),this.elements.$itemsInstance.length>0&&this.elements.$targetInstance.on("keydown",(e=>{this.setKeyboardEvents(e)}))),this.elements.has_swiper||("justify"!==this.elements.settings.data_layout?jQuery.each(this.elements.$imagesInstance,((e,t)=>{new IntersectionObserver(this.observeImageInViewport.bind(this),{threshold:.5}).observe(t)})):new IntersectionObserver(this.observeJustifyInViewport.bind(this)).observe(this.elements.$targetId[0])),jQuery(".e-n-tab-title").on("click",(()=>{setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),50)}))}observeImageInViewport(e,t){if(e[0].isIntersecting){const s=e[0].target;this.elements.settings.data_animate&&jQuery(s).closest("article").addClass("animate-first-load"),t.unobserve(s),this.elements.$targetId.isotope(this.elements.isotopeOptions),window.setTimeout((()=>{jQuery(s).closest("article").removeClass("animate-first-load")}),1e3)}}observeJustifyInViewport(e,t){if(e[0].isIntersecting){const s=e[0].target;this.elements.$targetId.imagesLoaded().always((()=>{this.elements.$targetJustify.fjGallery(this.elements.justifyOptions)})),t.unobserve(s)}}onFilterGridClick(e){const t=jQuery(e.currentTarget),s=t.parents(this.elements.filterWrapper);e.preventDefault(),t.parents(this.elements.filterItem).hasClass(this.elements.filterActive)||(s.find("."+this.elements.filterActive).removeClass(this.elements.filterActive),t.parents(this.elements.filterItem).addClass(this.elements.filterActive),this.elements.$targetId.isotope({filter:t.attr("data-filter")}))}onFilterGridChange(e){e.preventDefault(),this.elements.$targetId.isotope({filter:e.currentTarget.value})}onElementChange(e){if("ag_image_height"===e&&"justify"===this.elements.settings.data_layout){let t=this.elements.justifyOptions.rowHeight;"ag_image_height"===e?t=this.getElementSettings("ag_image_height").size:"ag_image_height_tablet_extra"===e?t=this.getElementSettings("ag_image_height_tablet_extra").size:"ag_image_height_tablet"===e?t=this.getElementSettings("ag_image_height_tablet").size:"ag_image_height_mobile_extra"===e?t=this.getElementSettings("ag_image_height_mobile_extra").size:"ag_image_height_mobile"===e?t=this.getElementSettings("ag_image_height_mobile").size:"ag_image_height_laptop"===e&&(t=this.getElementSettings("ag_image_height_laptop").size),this.elements.justifyOptions.rowHeight=t,this.elements.$targetId.imagesLoaded().always((()=>{this.elements.$targetJustify.fjGallery(this.elements.justifyOptions)}))}}setKeyboardEvents(e){const t='button, a, [tabindex]:not([tabindex="-1"])',s=e.code||e.key||0;let i=null,a=null,n=null,r=null;if(this.elements.settings.data_filtre){const e=this.elements.$targetId.isotope("getFilteredItemElements"),s=jQuery(e).find(t);i=s.first(),a=s.last()}else{const e=this.elements.$itemsInstance.find(t);i=e.first(),a=e.last()}if(n=i.closest(".advanced-gallery__content"),r=a.closest(".advanced-gallery__content"),"Tab"===s&&!e.shiftKey||"Tab"===s&&e.shiftKey)return!0;"Home"===s?(e.preventDefault(),"overlay-out"===this.elements.settings.data_overlay?i.trigger("focus"):(n.trigger("focus"),window.setTimeout((()=>{i.focus()}),500))):"End"===s?(e.preventDefault(),"overlay-out"===this.elements.settings.data_overlay?a.trigger("focus"):(r.trigger("focus"),window.setTimeout((()=>{a.focus()}),500))):"Escape"===s&&this.elements.$targetSkipGrid.trigger("focus")}}jQuery(window).on("elementor/frontend/init",(()=>{elementorFrontend.elementsHandler.attachHandler("eac-addon-advanced-gallery",widgetAdvancedGallery)}));