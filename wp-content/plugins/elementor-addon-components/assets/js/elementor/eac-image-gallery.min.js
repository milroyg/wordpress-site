import{EacSwiper,setGridItemsGlobalLink}from"../modules/eac-modules.js";class widgetImageGalerie extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{targetInstance:".eac-image-galerie",target:".image-galerie",targetSkipGrid:".eac-skip-grid",targetCards:".image-galerie__inner-wrapper",imagesInstance:".image-galerie__image-instance",itemsInstance:".image-galerie__item",targetJustify:".fj-gallery",filterWrapperLink:".ig-filters__wrapper a",filterWrapperSelect:".ig-filters__select"}}}getDefaultElements(){const e=this.getSettings("selectors");let t={$targetInstance:this.$element.find(e.targetInstance),$target:this.$element.find(e.target),$targetSkipGrid:this.$element.find(e.targetSkipGrid),$targetCards:this.$element.find(e.targetCards),$imagesInstance:this.$element.find(e.imagesInstance),$itemsInstance:this.$element.find(e.itemsInstance),$targetJustify:this.$element.find(e.targetJustify),$filterWrapperLink:this.$element.find(e.filterWrapperLink),$filterWrapperSelect:this.$element.find(e.filterWrapperSelect),settings:this.$element.find(e.target).data("settings"),$targetId:null,widgetId:this.$element.data("id"),iso:null,isotopeOptions:{itemSelector:".image-galerie__item",percentPosition:!0,masonry:{columnWidth:".image-galerie__item-sizer"},fitRows:{equalheight:!1},layoutMode:"fitRows",sortBy:"original-order",visibleStyle:{transform:"scale(1)",opacity:1}},justifyOptions:{itemSelector:".fj-gallery-item",rowHeight:250,rowHeightTolerance:0,edgeCaseMinRowHeight:1,gutter:10,calculateItemsHeight:!0},has_swiper:!1,activeBreakpoints:elementorFrontend.config.responsive.activeBreakpoints,windowWidthMob:0,windowWidthMobExtra:0,windowWidthTab:0,windowWidthTabExtra:0,windowWidthLaptop:0,windowWidthWidescreen:0};return t.$targetId=jQuery(t.settings.data_id),t.isotopeOptions.layoutMode=t.settings.data_layout,t.isotopeOptions.fitRows.equalheight="fitRows"===t.settings.data_layout,t.has_swiper=t.settings.data_sw_swiper||!1,t.justifyOptions.gutter=t.settings.data_gutter,t.justifyOptions.rowHeight=t.settings.data_rowheight,t}onInit(){super.onInit(),this.elements.has_swiper?new EacSwiper(this.elements.settings,this.elements.$targetInstance):"justify"!==this.elements.settings.data_layout&&(this.elements.settings.data_metro?this.elements.$itemsInstance.eq(0).addClass("layout-type-metro"):this.elements.$itemsInstance.eq(0).removeClass("layout-type-metro")),elementorFrontend.isEditMode()||setGridItemsGlobalLink(this.elements.$targetCards)}bindEvents(){elementorFrontend.isEditMode()||(!this.elements.has_swiper&&this.elements.settings.data_filtre&&(this.elements.$filterWrapperLink.on("click",(e=>{this.onFilterGridClick(e)})),this.elements.$filterWrapperSelect.on("change",(e=>{this.onFilterGridChange(e)}))),this.elements.$itemsInstance.length>0&&this.elements.$targetInstance.on("keydown",(e=>{this.setKeyboardEvents(e)}))),this.elements.has_swiper||("justify"!==this.elements.settings.data_layout?jQuery.each(this.elements.$imagesInstance,((e,t)=>{new IntersectionObserver(this.observeImageInViewport.bind(this),{threshold:.5}).observe(t)})):new IntersectionObserver(this.observeJustifyInViewport.bind(this)).observe(this.elements.$targetId[0])),jQuery(".e-n-tab-title").on("click",(()=>{setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),50)}))}observeImageInViewport(e,t){if(e[0].isIntersecting){const i=e[0].target;this.elements.settings.data_animate&&jQuery(i).closest("article").addClass("animate-first-load"),t.unobserve(i),this.elements.$targetId.isotope(this.elements.isotopeOptions),window.setTimeout((()=>{jQuery(i).closest("article").removeClass("animate-first-load")}),1e3)}}observeJustifyInViewport(e,t){if(e[0].isIntersecting){const i=e[0].target;this.elements.$targetId.imagesLoaded().always((()=>{this.elements.$targetJustify.fjGallery(this.elements.justifyOptions)})),t.unobserve(i)}}onFilterGridClick(e){const t=jQuery(e.currentTarget),i=t.parents(".ig-filters__wrapper");e.preventDefault(),t.parents(".ig-filters__item").hasClass("ig-active")||(i.find(".ig-active").removeClass("ig-active"),t.parents(".ig-filters__item").addClass("ig-active"),this.elements.$targetId.isotope({filter:t.attr("data-filter")}))}onFilterGridChange(e){e.preventDefault(),this.elements.$targetId.isotope({filter:e.currentTarget.value})}onElementChange(e){if("ig_image_height"===e&&"justify"===this.elements.settings.data_layout){let t=this.elements.justifyOptions.rowHeight;"ig_image_height"===e?t=this.getElementSettings("ig_image_height").size:"ig_image_height_tablet_extra"===e?t=this.getElementSettings("ig_image_height_tablet_extra").size:"ig_image_height_tablet"===e?t=this.getElementSettings("ig_image_height_tablet").size:"ig_image_height_mobile_extra"===e?t=this.getElementSettings("ig_image_height_mobile_extra").size:"ig_image_height_mobile"===e?t=this.getElementSettings("ig_image_height_mobile").size:"ig_image_height_laptop"===e&&(t=this.getElementSettings("ig_image_height_laptop").size),this.elements.justifyOptions.rowHeight=t,this.elements.$targetId.imagesLoaded().always((()=>{this.elements.$targetJustify.fjGallery(this.elements.justifyOptions)}))}}setKeyboardEvents(e){const t='button, a, [tabindex]:not([tabindex="-1"])',i=e.code||e.key||0;let s=null,n=null,a=null,r=null;if(this.elements.settings.data_filtre){const e=this.elements.$targetId.isotope("getFilteredItemElements"),i=jQuery(e).find(t);s=i.first(),n=i.last()}else{const e=this.elements.$itemsInstance.find(t);s=e.first(),n=e.last()}if(a=s.closest(".image-galerie__content"),r=n.closest(".image-galerie__content"),"Tab"===i&&!e.shiftKey||"Tab"===i&&e.shiftKey)return!0;"Home"===i?(e.preventDefault(),"overlay-out"===this.elements.settings.data_overlay?s.trigger("focus"):(a.trigger("focus"),window.setTimeout((()=>{s.focus()}),500))):"End"===i?(e.preventDefault(),"overlay-out"===this.elements.settings.data_overlay?n.trigger("focus"):(r.trigger("focus"),window.setTimeout((()=>{n.focus()}),500))):"Escape"===i&&this.elements.$targetSkipGrid.trigger("focus")}}jQuery(window).on("elementor/frontend/init",(()=>{elementorFrontend.elementsHandler.attachHandler("eac-addon-image-galerie",widgetImageGalerie)}));