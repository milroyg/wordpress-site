var timer,psacp_shrt_notice_timeout,timeOut_Val=300,timeOut=timeOut_Val,tmpl_id=jQuery(".psacp-customizer").attr("data-template"),preview_shortcode=jQuery(".psacp-customizer").attr("data-shortcode"),psacp_shrt_nonce=jQuery(".psacp-customizer").attr("data-nonce"),checked_show_dep=[],dep_wrap=".psacp-shrt-fields-panel",dependency=!!(dependency=jQuery(dep_wrap+" .psacp-cust-dependency").attr("data-dependency"))&&JSON.parse(dependency),psacp_shrt_ajax_fields=jQuery(dep_wrap+" .psacp-cust-dependency").attr("data-ajax-fields");function psacp_get_shortcode_params(e){var a=jQuery(e).val(),p=(a=a.trim()).substr(0,1),s=a.substr(-1);return""!=a&&("["==p&&"]"==s&&(p=(a=(a=a.slice(1,-1)).trim()).substr(0,1),s=a.substr(-1)),"["!=p&&(a="["+a),"]"!=s&&(a+="]"),jQuery(e).val(a),temp_shrt_val=a.slice(1,-1),temp_shrt_val=temp_shrt_val.trim(),wp.shortcode.attrs(temp_shrt_val))}function psacp_set_shortcode_params(t,e,a){var s=!1,c=".psacp-shrt-fields-panel";return"click"==a&&void 0!==e&&""!=e&&jQuery.each(e.named,function(p,e){var a,s;void 0!==p&&""!=p&&(p in t.named&&""!=t.named[p]||(a=jQuery(c+" .psacp-"+p).closest(".psacp-customizer-row").attr("data-type"),s=(s=jQuery(c+" .psacp-"+p).attr("data-default"))||"","dropdown"==a&&0<jQuery(c+" .psacp-"+p+" option[value='"+s+"']").length?jQuery(c+" .psacp-"+p).val(s).trigger("psacp-cust-dependency-change"):"multi-dropdown"==a?(jQuery(c+" .psacp-"+p).hasClass("psacp-ajax-select2")?jQuery(c+" .psacp-"+p).val(""):jQuery.each(s.split(","),function(e,a){jQuery(c+" .psacp-"+p+" option[value='"+a+"']").prop("selected",!0)}),jQuery(c+" .psacp-"+p).trigger("psacp-cust-dependency-change")):"colorpicker"==a?jQuery(c+" .psacp-"+p).val(s).trigger("change"):"text"!=a&&"number"!=a||jQuery(c+" .psacp-"+p).val(s).trigger("psacp-cust-dependency-change")))}),jQuery.each(t.named,function(p,e){var a;p&&("dropdown"==(a=jQuery(c+" .psacp-"+p).closest(".psacp-customizer-row").attr("data-type"))&&0<jQuery(c+" .psacp-"+p+" option[value='"+e+"']").length?jQuery(c+" .psacp-"+p).val(e).trigger("psacp-cust-dependency-change"):"multi-dropdown"==a?(jQuery.each(e.split(","),function(e,a){jQuery(c+" .psacp-"+p+" option[value='"+a+"']").prop("selected",!0)}),jQuery(c+" .psacp-"+p).trigger("psacp-cust-dependency-change")):"colorpicker"==a?jQuery(c+" .psacp-"+p).val(e).trigger("change"):"text"!=a&&"number"!=a||jQuery(c+" .psacp-"+p).val(e).trigger("psacp-cust-dependency-change"),s=!0)}),s}function psacp_generate_shortcode_preview(a){var o="",p=jQuery(".psacp-customizer"),n=jQuery(".psacp-shrt-fields-panel"),a=a||!1;clearTimeout(timer),timer=setTimeout(function(){jQuery(".psacp-shrt-preview-window .psacp-shrt-loader").fadeIn(),o+="["+preview_shortcode,n.find('input[type="text"], input[type="checkbox"]:checked, input[type="radio"], input[type="number"], textarea, select').each(function(e,a){var p,s,t,c;jQuery(this).hasClass("psacp-cust-hidden-field")||(p=(p=jQuery(this).val())||"",s=jQuery(this).attr("name"),t=jQuery(this).attr("data-default"),c=jQuery(this).attr("data-empty"),void 0===p||""==p&&!c||p==t||(o+=" "+s+'="'+p+'"'))}),o+="]",p.find(".psacp-shrt-box").val(o),p.find(".psacp-customizer-old-shrt").val(o);var s,t,r,e,c=!1;a&&(jQuery(".psacp-shrt-invalid-param-notice").hide(),jQuery(".psacp-shrt-acc-header-warn-icon").hide(),jQuery(".psacp-customizer-row").removeClass("psacp-customizer-row-error"),s={},t=psacp_get_shortcode_params(".psacp-shrt-box"),"force"==a&&(c=!0),psacp_shrt_ajax_fields&&jQuery.each(psacp_shrt_ajax_fields,function(e,a){var p;a in t.named&&(c=!0,(p=jQuery(".psacp-"+a).attr("data-predefined"))&&(s[a]=JSON.parse(p)))})),c?(r=jQuery(".psacp-shrt-accordion"),jQuery(".psacp-shrt-fields-panel .psacp-shrt-loader").fadeIn(),e={action:"psac_get_shrt_params_data",shortcode:preview_shortcode,params:t.named,predefined_params:s,nonce:psacp_shrt_nonce},jQuery.post(ajaxurl,e,function(s){var c;jQuery.isEmptyObject(s.invalid_params)||(c="",jQuery.each(s.invalid_params,function(e,a){jQuery(".psacp-shrt-invalid-param-notice").show();var p=r.find(".psacp-"+e).closest(".psacp-shrt-acc-cnt").attr("aria-labelledby"),s=r.find(".psacp-"+e).closest(".psacp-customizer-row"),t=s.find(".psacp-shrt-lbl").text();jQuery("#"+p+" .psacp-shrt-acc-header-warn-icon").show(),s.addClass("psacp-customizer-row-error"),c+=t+" ("+e+'="'+a+'"), '}),c=c.replace(/,\s*$/,""),jQuery(".psacp-shrt-invalid-param-notice .psacp-shrt-invalid-params").text(c)),jQuery.each(s.data,function(e,a){var p=r.find(".psacp-"+e).closest(".psacp-customizer-row").data("type");"multi-dropdown"==p||"dropdown"==p?r.find(".psacp-"+e).html(s.data[e]):r.find(".psacp-"+e).val(s.data[e])}),jQuery(".psacp-shrt-fields-panel .psacp-shrt-loader").fadeOut(),jQuery("#psacp-customizer-shrt-form").trigger("submit")})):jQuery("#psacp-customizer-shrt-form").trigger("submit")},timeOut)}function psacp_check_ref_dependency(p){var s;p in dependency&&(s=jQuery(dep_wrap+" .psacp-"+p).val(),jQuery.each(dependency[p].show,function(e,a){jQuery(dep_wrap+" .psacp-"+e).closest(".psacp-customizer-row").hide(),jQuery(dep_wrap+" .psacp-"+e).addClass("psacp-cust-hidden-field"),-1===jQuery.inArray(s,a)||jQuery(dep_wrap+" .psacp-"+p).hasClass("psacp-cust-hidden-field")||(jQuery(dep_wrap+" .psacp-"+e).closest(".psacp-customizer-row").show(),jQuery(dep_wrap+" .psacp-"+e).removeClass("psacp-cust-hidden-field")),psacp_check_ref_dependency(e)}),checked_show_dep.push(p))}function psacp_check_hide_ref_dependency(p){var s;p in dependency&&(s=jQuery(dep_wrap+" .psacp-"+p).val(),jQuery.each(dependency[p].hide,function(e,a){jQuery(dep_wrap+" .psacp-"+e).closest(".psacp-customizer-row").hide(),jQuery(dep_wrap+" .psacp-"+e).addClass("psacp-cust-hidden-field"),-1!=jQuery.inArray(s,a)||jQuery(dep_wrap+" .psacp-"+p).hasClass("psacp-cust-hidden-field")||(jQuery(dep_wrap+" .psacp-"+e).closest(".psacp-customizer-row").show(),jQuery(dep_wrap+" .psacp-"+e).removeClass("psacp-cust-hidden-field")),psacp_check_hide_ref_dependency(e)}))}function psacp_shrt_display_notice(e,a="success"){e&&(jQuery(".psacp-shrt-notice").remove(),jQuery("body").append('<div class="psacp-shrt-notice psacp-shrt-notice-'+a+'">'+e+"</div>"),jQuery(".psacp-shrt-notice").fadeIn(),clearTimeout(psacp_shrt_notice_timeout),psacp_shrt_notice_timeout=setTimeout(function(){jQuery(".psacp-shrt-notice").fadeOut()},5e3))}psacp_shrt_ajax_fields=!!psacp_shrt_ajax_fields&&JSON.parse(psacp_shrt_ajax_fields),function(i){"use strict";i(document).on("click",".psacp-shrt-dwp",function(){i("body").toggleClass("psacp-shrt-full-preview"),i(this).toggleClass("psacp-shrt-dwp-active")}),i("#psacp-shrt-accordion").accordion({collapsible:!0,active:!1,heightStyle:"content",icons:{header:"dashicons dashicons-arrow-down-alt2",activeHeader:"dashicons dashicons-arrow-up-alt2"}}),0<i(".psacp-cust-color-box").length&&i(".psacp-cust-color-box").wpColorPicker({change:function(e,a){psacp_generate_shortcode_preview(!0)},clear:function(){psacp_generate_shortcode_preview(!0)}}),i(document).on("change",'.psacp-shrt-fields-panel select, .psacp-shrt-fields-panel input[type="number"]',function(){var e=i(this),a=!0,p=(e.closest(".psacp-shrt-accordion"),e.attr("data-timeout"));timeOut=void 0!==p?p:timeOut_Val,e.hasClass("psacp-post-type-sel")&&(a="force"),psacp_generate_shortcode_preview(a)}),i(document).on("keyup",'.psacp-shrt-fields-panel input[type="text"], .psacp-shrt-fields-panel input[type="number"]',function(){var e=i(this).attr("data-timeout");timeOut=void 0!==e?e:timeOut_Val,psacp_generate_shortcode_preview(!0)}),i(document).on("change",".psacp-shrt-switcher",function(){0<i(".psacp-layout-wrap").length&&(e={title:i(".psacp-layout-wrap .psacp-layout-title").val()||"",description:i(".psacp-layout-wrap .psacp-layout-desc").val()||"",enable:i(".psacp-layout-enable").is(":checked")?1:0},e=JSON.stringify(e),psacp_create_cookie("psacp_layout_temp_data",e,!1,!1,"Strict"));var e=i(this).find(":selected").attr("data-url");void 0!==e&&""!=e&&(window.location=e)}),jQuery("#psacp-customizer-shrt-form").on("submit",function(e){var a=i(this).attr("target");if(void 0===a||""==a)return!1}),i(document).on("click",".psacp-cust-shrt-generate",function(e,a){var s,r,p,t=!1,c=!0,o=psacp_get_shortcode_params(".psacp-shrt-box"),n=psacp_get_shortcode_params(".psacp-customizer-old-shrt"),a=void 0!==a&&""!=a?a:"click";if(o&&o.numeric[0]&&o.numeric[0]!==preview_shortcode)return alert(Psacp_Shrt_Generator.shortcode_err),!1;i(".psacp-shrt-invalid-param-notice").hide(),i(".psacp-shrt-acc-header-warn-icon").hide(),i(".psacp-customizer-row").removeClass("psacp-customizer-row-error"),o.named&&(s={},psacp_shrt_ajax_fields&&i.each(psacp_shrt_ajax_fields,function(e,a){var p;a in o.named&&(c=!0,(p=i(".psacp-"+a).attr("data-predefined"))&&(s[a]=JSON.parse(p)))}),c?(r=i(".psacp-shrt-accordion"),i(".psacp-shrt-fields-panel .psacp-shrt-loader").fadeIn(),p={action:"psac_get_shrt_params_data",shortcode:preview_shortcode,params:o.named,predefined_params:s,nonce:psacp_shrt_nonce},i.post(ajaxurl,p,function(s){var c;i.isEmptyObject(s.invalid_params)||(c="",i.each(s.invalid_params,function(e,a){i(".psacp-shrt-invalid-param-notice").show();var p=r.find(".psacp-"+e).closest(".psacp-shrt-acc-cnt").attr("aria-labelledby"),s=r.find(".psacp-"+e).closest(".psacp-customizer-row"),t=s.find(".psacp-shrt-lbl").text();i("#"+p+" .psacp-shrt-acc-header-warn-icon").show(),s.addClass("psacp-customizer-row-error"),c+=t+" ("+e+'="'+a+'"), '}),c=c.replace(/,\s*$/,""),i(".psacp-shrt-invalid-param-notice .psacp-shrt-invalid-params").text(c)),i.each(s.data,function(e,a){var p=r.find(".psacp-"+e).closest(".psacp-customizer-row").data("type");"multi-dropdown"==p||"dropdown"==p?r.find(".psacp-"+e).html(s.data[e]):r.find(".psacp-"+e).val(s.data[e])}),psacp_set_shortcode_params(o,n,a),i(".psacp-shrt-fields-panel .psacp-shrt-loader").fadeOut(),psacp_generate_shortcode_preview()})):(t=psacp_set_shortcode_params(o,n,a),psacp_generate_shortcode_preview())),1!=t&&1!=c&&psacp_generate_shortcode_preview()}),""!=tmpl_id?setTimeout(function(){i(".psacp-cust-shrt-generate").trigger("click",["trigger"])},10):psacp_generate_shortcode_preview(),dependency&&i.each(dependency,function(e,a){e&&(setTimeout(function(){-1==i.inArray(e,checked_show_dep)&&i(dep_wrap+" .psacp-"+e).trigger("psacp-cust-dependency-change")},10),i(document).on("change keyup psacp-cust-dependency-change",dep_wrap+" .psacp-"+e,function(){var p=i(this).val();a.show&&i.each(a.show,function(e,a){i(dep_wrap+" .psacp-"+e).closest(".psacp-customizer-row").hide(),i(dep_wrap+" .psacp-"+e).addClass("psacp-cust-hidden-field"),-1!==i.inArray(p,a)&&(i(dep_wrap+" .psacp-"+e).closest(".psacp-customizer-row").show(),i(dep_wrap+" .psacp-"+e).removeClass("psacp-cust-hidden-field")),psacp_check_ref_dependency(e)}),a.hide&&i.each(a.hide,function(e,a){i(dep_wrap+" .psacp-"+e).closest(".psacp-customizer-row").show(),i(dep_wrap+" .psacp-"+e).removeClass("psacp-cust-hidden-field"),-1!==i.inArray(p,a)&&(i(dep_wrap+" .psacp-"+e).closest(".psacp-customizer-row").hide(),i(dep_wrap+" .psacp-"+e).addClass("psacp-cust-hidden-field")),psacp_check_hide_ref_dependency(e)})}))}),i(document).on("submit",".psacp-layout-submit-form",function(){var e=psacp_get_shortcode_params(".psacp-shrt-box");if(e&&e.numeric[0]&&e.numeric[0]!==preview_shortcode)return alert(Psacp_Shrt_Generator.shortcode_err),!1;e=i(".psacp-shrt-box").val();i(".psacp-layout-wrap .psacp-layout-shrt-val").val(e)}),i(document).on("click",".psacp-layout-debug-js",function(){return i(".psacp-layout-wrap .psacp-shrt-box-wrp").toggleClass("psacp-hide"),!1}),0<i(".psacp-layout-wrap").length&&psacp_delete_cookie("psacp_layout_temp_data","Strict"),i(".psacp-select2").each(function(e){i(this).select2({theme:"default psacp-select2-inp",width:"100%"})}),i(".psacp-ajax-select2").each(function(e){var a=i(this),s=i(this).attr("data-predefined"),p=i(this).data("ajax-action"),t=(t=i(this).data("search-msg"))||Psacp_Shrt_Generator.select2_input_too_short,c=(c=i(this).data("placeholder"))||Psacp_Shrt_Generator.select2_placeholder;void 0!==p&&""!=p&&a.select2({ajax:{url:ajaxurl,dataType:"json",delay:500,data:function(e){e=e.term.trim();return{action:p,search:e,nonce:psacp_shrt_nonce,post_type:i(".psacp-post-type-sel").val(),taxonomy:i(".psacp-taxonomy-sel").val(),all_parents_opt:a.hasClass("psacp-filter_cat_parent")?1:0}},processResults:function(e){var p=[];return s&&(p=JSON.parse(s),p=i.makeArray(p)),e&&i.each(e,function(e,a){p.push({id:a[0],text:a[1]})}),{results:p}},cache:!0},width:"100%",theme:"default psacp-select2-inp",minimumInputLength:1,allowClear:!0,closeOnSelect:!0,placeholder:c,language:{inputTooShort:function(){return t},removeAllItems:function(){return Psacp_Shrt_Generator.select2_remove_all_items},removeItem:function(){return Psacp_Shrt_Generator.select2_remove_item},searching:function(){return Psacp_Shrt_Generator.select2_searching}}}).on("select2:unselect",function(e){setTimeout(function(){a.select2("close")},10)})}),jQuery(".psacp-customizer .psacp-shrt-preview-frame").on("load",function(){jQuery(".psacp-shrt-preview-window .psacp-shrt-loader").fadeOut()})}(jQuery);